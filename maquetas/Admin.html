<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>findingU · Panel de Administración</title>

    <!-- Tailwind CDN (maquetación) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --bg-primary: #0b0f14;
            --bg-secondary: #121826;
        }

        body {
            background: var(--bg-primary);
            color: #fff;
        }

        html,
        body {
            height: 100%;
        }

        .bg-ambient {
            background:
                radial-gradient(circle at 20% 20%, rgba(59, 130, 246, .18), transparent 45%),
                radial-gradient(circle at 80% 30%, rgba(245, 185, 66, .15), transparent 45%),
                radial-gradient(circle at 50% 85%, rgba(139, 92, 246, .12), transparent 55%),
                linear-gradient(to bottom, var(--bg-primary), var(--bg-secondary));
        }

        .grain:before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
            mix-blend-mode: overlay;
            opacity: .22;
            pointer-events: none;
            border-radius: inherit;
        }

        .glow-blue {
            box-shadow: 0 0 40px rgba(59, 130, 246, .45);
        }

        .glow-gold {
            box-shadow: 0 0 40px rgba(245, 185, 66, .45);
        }

        :focus-visible {
            outline: 2px solid rgba(59, 130, 246, .85);
            outline-offset: 3px;
        }
    </style>
</head>

<body class="antialiased">

    <!-- Header -->
    <header class="border-b border-white/5 bg-[#0b0f14]/85 backdrop-blur">
        <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3 min-w-0">
                <div
                    class="h-9 w-9 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 shadow-[0_0_26px_rgba(59,130,246,.45)]">
                </div>
                <div class="min-w-0">
                    <div class="font-extrabold tracking-tight truncate">findingU</div>
                    <div class="text-xs text-zinc-400 -mt-0.5">Panel de administración</div>
                </div>
            </div>

            <div class="flex items-center gap-2 shrink-0">
                <div class="hidden sm:block rounded-2xl bg-white/5 border border-white/10 px-4 py-2">
                    <div class="text-[11px] text-zinc-400">Acciones urgentes</div>
                    <div class="text-sm font-extrabold" id="urgentCount">—</div>
                </div>
                <button
                    class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                    onclick="toggleControlCenter(true)">
                    Acciones
                </button>
                <button
                    class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                    onclick="toast('Crear pedido / acción rápida (hook)')">
                    Nuevo
                </button>
            </div>
        </div>
    </header>

    <!-- Layout -->
    <main class="mx-auto max-w-7xl px-4 py-4 h-[calc(100vh-56px)]">
        <div class="grid gap-4 lg:grid-cols-[260px_1fr] h-full">

            <!-- Sidebar nav -->
            <aside class="hidden lg:flex flex-col gap-3 h-full">
                <div class="relative rounded-3xl border border-white/10 bg-white/5 grain overflow-hidden p-4">
                    <div
                        class="absolute inset-0 bg-[radial-gradient(circle_at_35%_20%,rgba(59,130,246,0.10),transparent_55%)] pointer-events-none">
                    </div>
                    <div class="relative">
                        <div class="text-xs text-zinc-400">Navegación</div>
                        <div class="mt-3 flex flex-col gap-2">
                            <button
                                class="navbtn px-4 py-3 rounded-2xl bg-blue-500/10 border border-blue-400/30 text-left hover:bg-blue-500/15 transition"
                                onclick="setView('orders')">
                                <div class="text-sm font-semibold">Pedidos</div>
                                <div class="text-xs text-zinc-400 mt-0.5">Pendiente · Pagado · Entregado</div>
                            </button>

                            <button
                                class="navbtn px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left hover:bg-white/10 transition"
                                onclick="setView('customers')">
                                <div class="text-sm font-semibold">Clientes</div>
                                <div class="text-xs text-zinc-400 mt-0.5">Niveles · Estructura · Comisiones</div>
                            </button>

                            <button
                                class="navbtn px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left hover:bg-white/10 transition"
                                onclick="setView('products')">
                                <div class="text-sm font-semibold">Productos</div>
                                <div class="text-xs text-zinc-400 mt-0.5">Altas · Imágenes · CTA</div>
                            </button>

                            <button
                                class="navbtn px-4 py-3 rounded-2xl bg-white/5 border border-white/10 text-left hover:bg-white/10 transition"
                                onclick="setView('stats')">
                                <div class="text-sm font-semibold">Estadísticas</div>
                                <div class="text-xs text-zinc-400 mt-0.5">Ventas · Funnel · Alertas</div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="relative rounded-3xl border border-white/10 bg-ambient grain overflow-hidden p-4">
                    <div
                        class="absolute inset-0 bg-[radial-gradient(circle_at_70%_35%,rgba(245,185,66,0.12),transparent_55%)] pointer-events-none">
                    </div>
                    <div class="relative">
                        <div class="text-xs text-zinc-300/80">Estado del día</div>
                        <div class="mt-2 text-lg font-extrabold" id="todaySales">$—</div>
                        <div class="mt-1 text-xs text-zinc-400">Pedidos: <span id="todayOrders">—</span></div>
                        <div class="mt-1 text-xs text-zinc-400">Pendientes envío: <span id="pendingShip">—</span></div>
                    </div>
                </div>
            </aside>

            <!-- Center content (internal scroll) -->
            <section
                class="relative rounded-3xl border border-white/10 bg-white/5 grain overflow-hidden h-full flex flex-col">
                <div
                    class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(59,130,246,0.10),transparent_55%)] pointer-events-none">
                </div>

                <!-- Top bar (filters + search) -->
                <div class="relative px-5 pt-5 pb-3 border-b border-white/5">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div class="min-w-0">
                            <h1 class="text-xl sm:text-2xl font-extrabold tracking-tight" id="viewTitle">Pedidos</h1>
                            <p class="mt-1 text-xs sm:text-sm text-zinc-400" id="viewSubtitle">
                                Cambia estado: pendiente, pagado, entregado.
                            </p>
                        </div>

                        <div class="flex items-center gap-2">
                            <div
                                class="hidden md:flex items-center gap-2 rounded-2xl bg-[#121826] border border-white/10 px-3 py-2">
                                <span class="text-xs text-zinc-400">Buscar</span>
                                <input id="searchInput"
                                    class="w-56 bg-transparent text-sm text-zinc-200 placeholder:text-zinc-600 outline-none"
                                    placeholder="ID, cliente, email..." oninput="applyFilters()" />
                            </div>

                            <!-- Mobile search button -->
                            <button
                                class="md:hidden px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                onclick="toggleSearchSheet()">
                                Buscar
                            </button>

                            <button
                                class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                onclick="toast('Exportar CSV (hook)')">
                                Exportar
                            </button>
                        </div>
                    </div>

                    <!-- Orders status tabs (visible only in orders view) -->
                    <div id="ordersTabs" class="mt-4 flex flex-wrap gap-2">
                        <button
                            class="tabbtn px-4 py-2 rounded-full text-sm font-semibold bg-blue-500/10 border border-blue-400/30 hover:bg-blue-500/15 transition"
                            data-status="pending" onclick="setOrderStatusTab('pending')">Pendiente</button>
                        <button
                            class="tabbtn px-4 py-2 rounded-full text-sm font-semibold bg-white/5 border border-white/10 hover:bg-white/10 transition"
                            data-status="paid" onclick="setOrderStatusTab('paid')">Pagado</button>
                        <button
                            class="tabbtn px-4 py-2 rounded-full text-sm font-semibold bg-white/5 border border-white/10 hover:bg-white/10 transition"
                            data-status="delivered" onclick="setOrderStatusTab('delivered')">Entregado</button>
                    </div>
                </div>

                <!-- Scrollable content -->
                <div class="relative flex-1 overflow-auto p-5 space-y-4">

                    <!-- ORDERS VIEW -->
                    <div id="view-orders" class="space-y-4">
                        <div class="grid gap-3 md:grid-cols-3">
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Pendientes</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiPending">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Pagados</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiPaid">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Por enviar</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiShip">—</div>
                            </div>
                        </div>

                        <div class="rounded-2xl bg-[#121826] border border-white/10 overflow-hidden">
                            <div
                                class="px-4 py-3 bg-white/5 text-sm font-semibold text-zinc-200 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span>Lista de pedidos</span>
                                    <span class="text-xs text-zinc-400" id="ordersCount">—</span>
                                </div>

                                <button
                                    class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-xs"
                                    onclick="openNewOrderModal()">
                                    + Nuevo pedido
                                </button>
                            </div>


                            <div class="overflow-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-white/5 text-zinc-300">
                                        <tr>
                                            <th class="text-left px-4 py-3 font-semibold">ID</th>
                                            <th class="text-left px-4 py-3 font-semibold">Cliente</th>
                                            <th class="text-left px-4 py-3 font-semibold">Total</th>
                                            <th class="text-left px-4 py-3 font-semibold">Estado</th>
                                            <th class="text-left px-4 py-3 font-semibold">Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-white/5 text-zinc-200" id="ordersTable"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- CUSTOMERS VIEW -->
                    <div id="view-customers" class="hidden space-y-4">
                        <div class="grid gap-3 md:grid-cols-3">
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Clientes totales</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiCustomers">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Comisiones por depositar</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiCommissions">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Prom. descuento</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiAvgDiscount">—</div>
                            </div>
                        </div>

                        <div class="grid gap-4 lg:grid-cols-[1.05fr_.95fr]">
                            <!-- Customers list -->
                            <div class="rounded-2xl bg-[#121826] border border-white/10 overflow-hidden">
                                <div
                                    class="px-4 py-3 bg-white/5 text-sm font-semibold text-zinc-200 flex items-center justify-between">
                                    <span>Clientes (todos los niveles)</span>
                                    <span class="text-xs text-zinc-400" id="customersCount">—</span>
                                </div>

                                <div class="overflow-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-white/5 text-zinc-300">
                                            <tr>
                                                <th class="text-left px-4 py-3 font-semibold">Cliente</th>
                                                <th class="text-left px-4 py-3 font-semibold">Nivel</th>
                                                <th class="text-left px-4 py-3 font-semibold">Descuento</th>
                                                <th class="text-left px-4 py-3 font-semibold">Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-white/5 text-zinc-200" id="customersTable">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Customer detail (structure + commissions) -->
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="flex items-start justify-between gap-3">
                                    <div>
                                        <div class="text-sm font-semibold text-zinc-200">Detalle del cliente</div>
                                        <div class="text-xs text-zinc-400 mt-1" id="custDetailHint">Selecciona un
                                            cliente para ver su estructura.</div>
                                    </div>
                                    <button
                                        class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                        onclick="toast('Abrir perfil completo (hook)')">
                                        Perfil
                                    </button>
                                </div>

                                <div class="mt-4 rounded-2xl bg-black/20 border border-white/10 p-4">
                                    <div class="flex items-start justify-between gap-3">
                                        <div>
                                            <div class="text-xs text-zinc-400">Cliente</div>
                                            <div class="text-lg font-extrabold" id="custName">—</div>
                                            <div class="text-xs text-zinc-500 mt-1" id="custEmail">—</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xs text-zinc-400">Nivel</div>
                                            <div class="text-lg font-extrabold" id="custLevel">—</div>
                                            <div class="text-xs text-yellow-300 mt-1" id="custDiscount">—</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4 grid gap-3 md:grid-cols-2">
                                    <div class="rounded-2xl bg-black/20 border border-white/10 p-4">
                                        <div class="text-xs text-zinc-400">Comisiones por depositar</div>
                                        <div class="text-2xl font-extrabold mt-1" id="custCommissions">$—</div>
                                        <button
                                            class="mt-3 w-full px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                                            onclick="toast('Marcar comisiones como pagadas (hook)')">
                                            Pagar comisiones
                                        </button>
                                    </div>
                                    <div class="rounded-2xl bg-black/20 border border-white/10 p-4">
                                        <div class="text-xs text-zinc-400">Acción sugerida</div>
                                        <div class="text-sm text-zinc-300 mt-1" id="custAction">
                                            Selecciona un cliente para recomendaciones.
                                        </div>
                                        <button
                                            class="mt-3 w-full px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                            onclick="toast('Enviar recordatorio (hook)')">
                                            Enviar recordatorio
                                        </button>
                                    </div>
                                </div>

                                <!-- Structure graph (SVG mock) -->
                                <div class="mt-4 rounded-2xl bg-black/20 border border-white/10 p-4 overflow-hidden">
                                    <div class="mt-3 flex gap-2">
                                        <button
                                            class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                            onclick="toast('Selecciona un nodo L1/L2 y presiona +')">
                                            Cómo agregar
                                        </button>

                                        <button
                                            class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                                            onclick="toast('Selecciona un nodo L1/L2 y presiona +')">
                                            Agregar a estructura
                                        </button>
                                    </div>

                                    <div class="text-xs text-zinc-400 mt-1">Mock. En producción: pintar con datos
                                        reales.</div>
                                    <svg viewBox="0 0 560 220" class="w-full h-[220px] mt-3" id="custGraph">
                                        <g stroke="rgba(255,255,255,.18)" stroke-width="2">
                                            <line x1="120" y1="110" x2="260" y2="70"></line>
                                            <line x1="120" y1="110" x2="260" y2="110"></line>
                                            <line x1="120" y1="110" x2="260" y2="150"></line>
                                            <line x1="260" y1="70" x2="420" y2="60"></line>
                                            <line x1="260" y1="70" x2="420" y2="90"></line>
                                            <line x1="260" y1="110" x2="420" y2="110"></line>
                                            <line x1="260" y1="150" x2="420" y2="140"></line>
                                            <line x1="260" y1="150" x2="420" y2="170"></line>
                                        </g>
                                        <g>
                                            <circle cx="120" cy="110" r="26" fill="rgba(59,130,246,.92)"></circle>
                                            <text x="120" y="115" text-anchor="middle" font-size="12" fill="#0b0f14"
                                                font-weight="800">Yo</text>

                                            <circle cx="260" cy="70" r="16" fill="rgba(245,185,66,.92)"></circle>
                                            <text x="260" y="74" text-anchor="middle" font-size="10" fill="#0b0f14"
                                                font-weight="800">L1</text>

                                            <circle cx="260" cy="110" r="16" fill="rgba(245,185,66,.92)"></circle>
                                            <text x="260" y="114" text-anchor="middle" font-size="10" fill="#0b0f14"
                                                font-weight="800">L1</text>

                                            <circle cx="260" cy="150" r="16" fill="rgba(245,185,66,.92)"></circle>
                                            <text x="260" y="154" text-anchor="middle" font-size="10" fill="#0b0f14"
                                                font-weight="800">L1</text>

                                            <circle cx="420" cy="60" r="12" fill="rgba(139,92,246,.92)"></circle>
                                            <text x="420" y="64" text-anchor="middle" font-size="9" fill="#0b0f14"
                                                font-weight="900">L2</text>

                                            <circle cx="420" cy="90" r="12" fill="rgba(139,92,246,.92)"></circle>
                                            <text x="420" y="94" text-anchor="middle" font-size="9" fill="#0b0f14"
                                                font-weight="900">L2</text>

                                            <circle cx="420" cy="110" r="12" fill="rgba(139,92,246,.92)"></circle>
                                            <text x="420" y="114" text-anchor="middle" font-size="9" fill="#0b0f14"
                                                font-weight="900">L2</text>

                                            <circle cx="420" cy="140" r="12" fill="rgba(139,92,246,.92)"></circle>
                                            <text x="420" y="144" text-anchor="middle" font-size="9" fill="#0b0f14"
                                                font-weight="900">L2</text>

                                            <circle cx="420" cy="170" r="12" fill="rgba(139,92,246,.92)"></circle>
                                            <text x="420" y="174" text-anchor="middle" font-size="9" fill="#0b0f14"
                                                font-weight="900">L2</text>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PRODUCTS VIEW -->
                    <div id="view-products" class="hidden space-y-4">
                        <div class="grid gap-3 md:grid-cols-3">
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Productos activos</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiProducts">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Assets faltantes</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiMissingAssets">—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Producto del mes</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiPOM">—</div>
                            </div>
                        </div>

                        <div class="grid gap-4 lg:grid-cols-[1.05fr_.95fr]">
                            <!-- Product list -->
                            <div class="rounded-2xl bg-[#121826] border border-white/10 overflow-hidden">
                                <div
                                    class="px-4 py-3 bg-white/5 text-sm font-semibold text-zinc-200 flex items-center justify-between">
                                    <span>Catálogo</span>
                                    <span class="text-xs text-zinc-400" id="productsCount">—</span>
                                </div>

                                <div class="overflow-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-white/5 text-zinc-300">
                                            <tr>
                                                <th class="text-left px-4 py-3 font-semibold">Producto</th>
                                                <th class="text-left px-4 py-3 font-semibold">Precio</th>
                                                <th class="text-left px-4 py-3 font-semibold">Estado</th>
                                                <th class="text-left px-4 py-3 font-semibold">Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-white/5 text-zinc-200" id="productsTable"></tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Add/edit product + assets uploader -->
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="flex items-start justify-between gap-3">
                                    <div>
                                        <div class="text-sm font-semibold text-zinc-200">Agregar / editar producto</div>
                                        <div class="text-xs text-zinc-400 mt-1">Incluye todas las imágenes requeridas
                                            para marketing.</div>
                                    </div>
                                    <button
                                        class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                                        onclick="toast('Guardar producto (hook)')">
                                        Guardar
                                    </button>
                                </div>

                                <div class="mt-4 grid gap-2 md:grid-cols-2">
                                    <label class="block md:col-span-2">
                                        <span class="text-[11px] text-zinc-400">Nombre</span>
                                        <input
                                            class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-3 py-2.5 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                            placeholder="COLÁGENO..." />
                                    </label>
                                    <label class="block">
                                        <span class="text-[11px] text-zinc-400">Precio</span>
                                        <input type="number"
                                            class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-3 py-2.5 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                            placeholder="0" />
                                    </label>
                                    <label class="block">
                                        <span class="text-[11px] text-zinc-400">SKU</span>
                                        <input
                                            class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-3 py-2.5 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                            placeholder="SKU-0001" />
                                    </label>

                                    <label class="block md:col-span-2">
                                        <span class="text-[11px] text-zinc-400">Descripción corta (hook)</span>
                                        <input
                                            class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-3 py-2.5 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                            placeholder="Beneficio principal en 1 línea..." />
                                    </label>
                                </div>

                                <!-- Assets -->
                                <div class="mt-4 rounded-2xl bg-black/20 border border-white/10 p-4">
                                    <div class="text-sm font-semibold text-zinc-200">Imágenes / Assets</div>
                                    <div class="text-xs text-zinc-400 mt-1">
                                        Sube las imágenes necesarias para: CTA, links de redes, miniatura de carrito y
                                        Producto del Mes.
                                    </div>

                                    <div class="mt-4 grid gap-3 sm:grid-cols-2" id="assetsGrid"></div>

                                    <div class="mt-3 text-[11px] text-zinc-500">
                                        Nota: En producción, valida tamaño, peso (KB/MB), formato (webp/png/jpg) y
                                        genera variantes.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- STATS VIEW -->
                    <div id="view-stats" class="hidden space-y-4">
                        <div class="grid gap-3 md:grid-cols-4">
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Ventas (hoy)</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiSalesToday">$—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Conversión</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiConv">—%</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Ticket promedio</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiAov">$—</div>
                            </div>
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-[11px] text-zinc-400">Recompra</div>
                                <div class="text-2xl font-extrabold mt-1" id="kpiRepeat">—%</div>
                            </div>
                        </div>

                        <div class="grid gap-4 lg:grid-cols-2">
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-sm font-semibold text-zinc-200">Advertencias (acciones por realizar)
                                </div>
                                <div class="text-xs text-zinc-400 mt-1">Priorizadas por impacto operativo.</div>

                                <div class="mt-4 space-y-3" id="warningsList"></div>
                            </div>

                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-sm font-semibold text-zinc-200">Tendencia (mock)</div>
                                <div class="text-xs text-zinc-400 mt-1">Placeholder visual para dashboards.</div>

                                <div class="mt-4 rounded-2xl bg-black/20 border border-white/10 p-4 overflow-hidden">
                                    <svg viewBox="0 0 560 180" class="w-full h-[180px]">
                                        <path
                                            d="M20 140 C 90 90, 140 120, 190 80 C 240 40, 300 70, 350 60 C 410 45, 460 70, 540 30"
                                            fill="none" stroke="rgba(59,130,246,.85)" stroke-width="4" />
                                        <path d="M20 160 L540 160" stroke="rgba(255,255,255,.12)" stroke-width="2" />
                                        <circle cx="540" cy="30" r="6" fill="rgba(245,185,66,.92)" />
                                    </svg>
                                    <div class="mt-3 text-xs text-zinc-500">
                                        En producción: alimenta con ventas por día, cohortes, y funnel del checkout.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </section>


            <aside id="controlCenterOverlay" class="fixed inset-0 z-50 hidden">
                <!-- Backdrop -->
                <div class="absolute inset-0 bg-black/60" onclick="toggleControlCenter(false)"></div>

                <!-- Panel -->
                <div class="absolute right-0 top-0 h-full w-[92vw] max-w-[420px]
              rounded-l-3xl border-l border-white/10 bg-ambient grain overflow-hidden
              shadow-[0_30px_120px_rgba(0,0,0,0.75)]">
                    <div
                        class="absolute inset-0 bg-[radial-gradient(circle_at_70%_35%,rgba(245,185,66,0.14),transparent_55%)] pointer-events-none">
                    </div>

                    <div class="relative h-full flex flex-col">
                        <div class="p-5 border-b border-white/5 flex items-start justify-between gap-3">
                            <div>
                                <div class="text-sm font-semibold text-zinc-200">Centro de control</div>
                                <div class="text-xs text-zinc-400 mt-1">Lo urgente y lo importante, sin estorbar el
                                    trabajo.</div>
                            </div>
                            <button
                                class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                onclick="toggleControlCenter(false)">
                                Cerrar
                            </button>
                        </div>

                        <div class="relative p-5 flex-1 overflow-auto space-y-4">
                            <!-- Urgent cards -->
                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-xs text-zinc-400">Comisiones por pagar</div>
                                <div class="text-2xl font-extrabold mt-1" id="commDue">$—</div>
                                <button
                                    class="mt-3 w-full px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                                    onclick="setView('customers'); toggleControlCenter(false); toast('Filtrando comisiones por depositar…')">
                                    Revisar
                                </button>
                            </div>

                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-xs text-zinc-400">Pedidos por enviar</div>
                                <div class="text-2xl font-extrabold mt-1" id="shipDue">—</div>
                                <button
                                    class="mt-3 w-full px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                    onclick="setView('orders'); setOrderStatusTab('paid'); toggleControlCenter(false); toast('Mostrando pedidos listos para envío…')">
                                    Ver pedidos
                                </button>
                            </div>

                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-xs text-zinc-400">Assets faltantes (marketing)</div>
                                <div class="text-2xl font-extrabold mt-1" id="assetsMissing">—</div>
                                <button
                                    class="mt-3 w-full px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                    onclick="setView('products'); toggleControlCenter(false); toast('Abriendo panel de productos…')">
                                    Resolver
                                </button>
                            </div>

                            <div class="rounded-2xl bg-[#121826] border border-white/10 p-4">
                                <div class="text-sm font-semibold text-zinc-200">Acciones rápidas</div>
                                <div class="mt-3 grid grid-cols-2 gap-2">
                                    <button
                                        class="px-4 py-3 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                        onclick="toast('Crear cupón / promo (hook)')">
                                        Promo
                                    </button>
                                    <button
                                        class="px-4 py-3 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                        onclick="toast('Enviar broadcast (hook)')">
                                        Mensaje
                                    </button>
                                    <button
                                        class="px-4 py-3 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                        onclick="toast('Importar clientes (hook)')">
                                        Importar
                                    </button>
                                    <button
                                        class="px-4 py-3 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                                        onclick="toast('Corte/conciliación (hook)')">
                                        Corte
                                    </button>
                                </div>
                            </div>

                            <div class="text-xs text-zinc-500">
                                Recomendación: alertas por SLA (“pagado hace 24h sin guía”), y por liquidez (“comisiones
                                vencidas”).
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- =========================
  2) CAMBIO EN EL GRID PRINCIPAL
  En tu <main> cambia:
  lg:grid-cols-[260px_1fr_360px]
  por:
  lg:grid-cols-[260px_1fr]
  y ELIMINA el aside derecho anterior (ya lo reemplazamos arriba).
========================= -->


        </div>
    </main>

    <!-- Mobile bottom nav (single-screen friendly) -->
    <div class="fixed bottom-0 left-0 right-0 z-50 border-t border-white/10 bg-[#0b0f14]/92 backdrop-blur lg:hidden">
        <div class="mx-auto max-w-7xl px-4 py-3">
            <div class="grid grid-cols-4 gap-2">
                <button
                    class="mobbtn px-3 py-3 rounded-2xl bg-blue-500/10 border border-blue-400/30 text-xs font-semibold"
                    onclick="setView('orders')">Pedidos</button>
                <button class="mobbtn px-3 py-3 rounded-2xl bg-white/5 border border-white/10 text-xs font-semibold"
                    onclick="setView('customers')">Clientes</button>
                <button class="mobbtn px-3 py-3 rounded-2xl bg-white/5 border border-white/10 text-xs font-semibold"
                    onclick="setView('products')">Productos</button>
                <button class="mobbtn px-3 py-3 rounded-2xl bg-white/5 border border-white/10 text-xs font-semibold"
                    onclick="setView('stats')">Stats</button>
            </div>
        </div>
    </div>

    <!-- Search sheet (mobile) -->
    <div id="searchBackdrop" class="fixed inset-0 z-50 hidden lg:hidden">
        <div class="absolute inset-0 bg-black/60" onclick="toggleSearchSheet()"></div>
        <div class="absolute left-0 right-0 bottom-0 rounded-t-3xl border-t border-white/10 bg-[#121826]">
            <div class="px-5 py-4 flex items-center justify-between">
                <div>
                    <div class="text-sm font-semibold text-zinc-200">Buscar</div>
                    <div class="text-xs text-zinc-500">ID, cliente, email, SKU…</div>
                </div>
                <button
                    class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                    onclick="toggleSearchSheet()">Cerrar</button>
            </div>
            <div class="px-5 pb-5">
                <input id="searchInputM"
                    class="w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-zinc-200 placeholder:text-zinc-600"
                    placeholder="Buscar…" oninput="syncMobileSearch()" />
            </div>
        </div>
    </div>

    <!-- Quick actions sheet -->
    <div id="qaBackdrop" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60" onclick="toggleQuickActions()"></div>
        <div
            class="absolute left-0 right-0 bottom-0 rounded-t-3xl border-t border-white/10 bg-[#121826] overflow-hidden">
            <div class="px-5 py-4 flex items-center justify-between">
                <div>
                    <div class="text-sm font-semibold text-zinc-200">Acciones urgentes</div>
                    <div class="text-xs text-zinc-500">Resolver en prioridad operativa.</div>
                </div>
                <button
                    class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                    onclick="toggleQuickActions()">Cerrar</button>
            </div>
            <div class="px-5 pb-5 space-y-3" id="qaList"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-[92px] left-1/2 -translate-x-1/2 z-[60] hidden">
        <div
            class="rounded-full bg-[#121826] border border-white/10 px-5 py-3 text-sm text-zinc-200 shadow-[0_20px_60px_rgba(0,0,0,0.6)]">
            <span id="toastText">Actualizado.</span>
        </div>
    </div>

    <!-- =========================
  MODALES (PEGAR AL FINAL DEL <body>, antes de </body>)
  - Modal: Nuevo Pedido
  - Modal: Agregar cliente a estructura (L1/L2)
========================= -->

    <!-- Backdrop shared -->
    <div id="modalBackdrop" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-black/70" onclick="closeModal()"></div>
    </div>

    <!-- Modal: Nuevo Pedido -->
    <div id="modalNewOrder" class="fixed inset-0 z-[71] hidden">
        <div class="absolute inset-0 pointer-events-none"></div>

        <div class="absolute left-1/2 top-1/2 w-[92vw] max-w-[720px] -translate-x-1/2 -translate-y-1/2">
            <div
                class="relative rounded-3xl border border-white/10 bg-[#121826] grain overflow-hidden shadow-[0_30px_120px_rgba(0,0,0,0.75)]">
                <div
                    class="absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(59,130,246,0.12),transparent_55%)] pointer-events-none">
                </div>

                <div class="relative p-5 border-b border-white/5 flex items-start justify-between gap-3">
                    <div>
                        <div class="text-sm font-semibold text-zinc-200">Nuevo pedido</div>
                        <div class="text-xs text-zinc-500 mt-1">Captura rápida para operación (maqueta).</div>
                    </div>
                    <button
                        class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                        onclick="closeModal()">
                        Cerrar
                    </button>
                </div>

                <div class="relative p-5 space-y-4">
                    <div class="grid gap-3 sm:grid-cols-2">
                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Cliente</span>
                            <input id="orderCustomerName"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="Nombre del cliente" />
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Email (opcional)</span>
                            <input id="orderCustomerEmail"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="correo@ejemplo.com" />
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Estado inicial</span>
                            <select id="orderStatus"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white focus:border-blue-500/70">
                                <option value="pending">Pendiente</option>
                                <option value="paid">Pagado</option>
                                <option value="delivered">Entregado</option>
                            </select>
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Total</span>
                            <input id="orderTotal" type="number" min="0"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="0" />
                        </label>
                    </div>

                    <div class="rounded-2xl bg-black/20 border border-white/10 p-4">
                        <div class="text-xs text-zinc-400">Nota operativa (opcional)</div>
                        <textarea id="orderNote"
                            class="mt-2 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                            rows="3" placeholder="Dirección, guía, observaciones..."></textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button
                            class="sm:flex-1 px-5 py-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                            onclick="closeModal()">
                            Cancelar
                        </button>
                        <button
                            class="sm:flex-1 px-5 py-3 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                            onclick="createOrder()">
                            Crear pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Agregar cliente a estructura (L1/L2) -->
    <div id="modalAddToStructure" class="fixed inset-0 z-[71] hidden">
        <div class="absolute inset-0 pointer-events-none"></div>

        <div class="absolute left-1/2 top-1/2 w-[92vw] max-w-[760px] -translate-x-1/2 -translate-y-1/2">
            <div
                class="relative rounded-3xl border border-white/10 bg-[#121826] grain overflow-hidden shadow-[0_30px_120px_rgba(0,0,0,0.75)]">
                <div
                    class="absolute inset-0 bg-[radial-gradient(circle_at_70%_20%,rgba(245,185,66,0.10),transparent_55%)] pointer-events-none">
                </div>

                <div class="relative p-5 border-b border-white/5 flex items-start justify-between gap-3">
                    <div>
                        <div class="text-sm font-semibold text-zinc-200">Agregar cliente a estructura</div>
                        <div class="text-xs text-zinc-500 mt-1">
                            Se agregará debajo del nodo seleccionado (<span class="text-zinc-200 font-semibold"
                                id="structureTargetLabel">—</span>).
                        </div>
                    </div>
                    <button
                        class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                        onclick="closeModal()">
                        Cerrar
                    </button>
                </div>

                <div class="relative p-5 space-y-4">
                    <div class="grid gap-3 sm:grid-cols-2">
                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Nombre</span>
                            <input id="structName"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="Nombre del cliente" />
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Email</span>
                            <input id="structEmail"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="correo@ejemplo.com" />
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Teléfono (opcional)</span>
                            <input id="structPhone"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                                placeholder="+52..." />
                        </label>

                        <label class="block">
                            <span class="text-[11px] text-zinc-400">Nivel / descuento inicial</span>
                            <select id="structLevel"
                                class="mt-1 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white focus:border-blue-500/70">
                                <option value="Bronce|5%">Bronce · 5%</option>
                                <option value="Plata|10%">Plata · 10%</option>
                                <option value="Oro|15%">Oro · 15%</option>
                            </select>
                        </label>
                    </div>

                    <div class="rounded-2xl bg-black/20 border border-white/10 p-4">
                        <div class="text-xs text-zinc-400">Notas (opcional)</div>
                        <textarea id="structNote"
                            class="mt-2 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-white placeholder:text-zinc-600 focus:border-blue-500/70"
                            rows="3" placeholder="Contexto del registro, fuente, campaña..."></textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-3">
                        <button
                            class="sm:flex-1 px-5 py-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                            onclick="closeModal()">
                            Cancelar
                        </button>
                        <button
                            class="sm:flex-1 px-5 py-3 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-semibold glow-gold hover:scale-[1.02] transition-transform text-sm"
                            onclick="addClientToStructure()">
                            Agregar a estructura
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        /******************************
         * Helpers
         ******************************/
        function money(n) { return "$" + Number(n || 0).toFixed(0); }
        function toast(msg) {
            const el = document.getElementById("toast");
            const txt = document.getElementById("toastText");
            txt.textContent = msg;
            el.classList.remove("hidden");
            clearTimeout(window.__t);
            window.__t = setTimeout(() => el.classList.add("hidden"), 2200);
        }

        function assetUploader(label, hint, key) {
            // Returns HTML string (used in template literal above)
            return `
        <label class="block rounded-2xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 transition">
          <div class="flex items-start justify-between gap-2">
            <div>
              <div class="text-xs font-semibold text-zinc-200">${label}</div>
              <div class="text-[11px] text-zinc-500 mt-0.5">${hint}</div>
            </div>
            <span class="text-[11px] text-zinc-500">.png/.jpg/.webp</span>
          </div>
          <input type="file" accept="image/*" class="mt-3 block w-full text-xs text-zinc-300 file:mr-3 file:rounded-full file:border-0 file:bg-blue-500/10 file:text-zinc-100 file:px-4 file:py-2 file:font-semibold hover:file:bg-blue-500/15"
                 onchange="previewAsset(event, '${key}')">
          <div class="mt-3 rounded-2xl bg-black/20 border border-white/10 overflow-hidden h-20 flex items-center justify-center">
            <img id="asset-${key}" alt="${label}" class="w-full h-full object-cover hidden" />
            <div id="asset-ph-${key}" class="text-[11px] text-zinc-500">Preview</div>
          </div>
        </label>
      `;
        }


        /******************************
         * Mock Data
         ******************************/
        const DB = {
            orders: [
                { id: "#1001", customer: "Ana López", total: 120, status: "pending" },
                { id: "#1002", customer: "Carlos Ruiz", total: 89, status: "paid" },
                { id: "#1003", customer: "María Pérez", total: 210, status: "paid" },
                { id: "#1004", customer: "Luis Gómez", total: 60, status: "delivered" },
            ],
            customers: [
                {
                    id: 1,
                    name: "Ana López",
                    email: "ana@mail.com",
                    level: "Oro",
                    discount: "15%",
                    commissions: 320,
                },
                {
                    id: 2,
                    name: "Carlos Ruiz",
                    email: "carlos@mail.com",
                    level: "Plata",
                    discount: "10%",
                    commissions: 120,
                },
                {
                    id: 3,
                    name: "María Pérez",
                    email: "maria@mail.com",
                    level: "Bronce",
                    discount: "5%",
                    commissions: 0,
                },
            ],
            products: [
                { id: 1, name: "COLÁGENO", price: 35, active: true },
                { id: 2, name: "OMEGA-3", price: 29, active: true },
                { id: 3, name: "COMPLEJO B", price: 24, active: false },
            ],
            warnings: [
                { type: "commissions", text: "3 comisiones pendientes por depositar", severity: "high" },
                { type: "shipping", text: "2 pedidos pagados sin envío", severity: "high" },
                { type: "assets", text: "Producto sin imagen para redes", severity: "medium" },
            ]
        };

        /******************************
         * Global state
         ******************************/
        let currentView = "orders";
        let currentOrderStatus = "pending";

        /******************************
         * View switching
         ******************************/
        function setView(view) {
            currentView = view;

            document.querySelectorAll('[id^="view-"]').forEach(v => v.classList.add("hidden"));
            document.getElementById(`view-${view}`).classList.remove("hidden");

            // Update nav buttons
            document.querySelectorAll(".navbtn, .mobbtn").forEach(b => {
                b.classList.remove("bg-blue-500/10", "border-blue-400/30");
                b.classList.add("bg-white/5", "border-white/10");
            });

            document.querySelectorAll(`[onclick="setView('${view}')"]`).forEach(b => {
                b.classList.add("bg-blue-500/10", "border-blue-400/30");
            });

            // Update header
            const titles = {
                orders: ["Pedidos", "Cambia estado: pendiente, pagado, entregado."],
                customers: ["Clientes", "Niveles, estructura y comisiones."],
                products: ["Productos", "Catálogo, imágenes y CTA."],
                stats: ["Estadísticas", "Ventas, funnel y advertencias."]
            };
            document.getElementById("viewTitle").textContent = titles[view][0];
            document.getElementById("viewSubtitle").textContent = titles[view][1];

            // Toggle orders tabs
            document.getElementById("ordersTabs").classList.toggle("hidden", view !== "orders");

            render();
        }

        /******************************
         * Orders
         ******************************/
        function setOrderStatusTab(status) {
            currentOrderStatus = status;

            document.querySelectorAll(".tabbtn").forEach(b => {
                b.classList.remove("bg-blue-500/10", "border-blue-400/30");
                b.classList.add("bg-white/5", "border-white/10");
            });

            document.querySelector(`[data-status="${status}"]`)
                .classList.add("bg-blue-500/10", "border-blue-400/30");

            renderOrders();
        }

        function renderOrders() {
            const tbody = document.getElementById("ordersTable");
            const filtered = DB.orders.filter(o => o.status === currentOrderStatus);

            tbody.innerHTML = filtered.map(o => `
    <tr>
      <td class="px-4 py-3">${o.id}</td>
      <td class="px-4 py-3">${o.customer}</td>
      <td class="px-4 py-3 font-semibold">${money(o.total)}</td>
      <td class="px-4 py-3 capitalize">${o.status}</td>
      <td class="px-4 py-3">
        <button class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-xs"
                onclick="advanceOrder('${o.id}')">
          Cambiar estado
        </button>
      </td>
    </tr>
  `).join("");

            document.getElementById("ordersCount").textContent = `${filtered.length} pedidos`;

            document.getElementById("kpiPending").textContent =
                DB.orders.filter(o => o.status === "pending").length;
            document.getElementById("kpiPaid").textContent =
                DB.orders.filter(o => o.status === "paid").length;
            document.getElementById("kpiShip").textContent =
                DB.orders.filter(o => o.status === "paid").length;
        }

        function advanceOrder(id) {
            const order = DB.orders.find(o => o.id === id);
            if (!order) return;

            if (order.status === "pending") order.status = "paid";
            else if (order.status === "paid") order.status = "delivered";

            toast(`Pedido ${id} actualizado.`);
            renderOrders();
            renderStats();
        }

        /******************************
         * Customers
         ******************************/
        function renderCustomers() {
            const tbody = document.getElementById("customersTable");

            tbody.innerHTML = DB.customers.map(c => `
    <tr>
      <td class="px-4 py-3">${c.name}</td>
      <td class="px-4 py-3">${c.level}</td>
      <td class="px-4 py-3 text-yellow-300">${c.discount}</td>
      <td class="px-4 py-3">
        <button class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-xs"
                onclick="selectCustomer(${c.id})">
          Ver
        </button>
      </td>
    </tr>
  `).join("");

            document.getElementById("customersCount").textContent = `${DB.customers.length} clientes`;
            document.getElementById("kpiCustomers").textContent = DB.customers.length;
            document.getElementById("kpiCommissions").textContent =
                money(DB.customers.reduce((a, c) => a + c.commissions, 0));
            document.getElementById("kpiAvgDiscount").textContent = "10%";
        }

        function selectCustomer(id) {
            const c = DB.customers.find(x => x.id === id);
            if (!c) return;

            document.getElementById("custName").textContent = c.name;
            document.getElementById("custEmail").textContent = c.email;
            document.getElementById("custLevel").textContent = c.level;
            document.getElementById("custDiscount").textContent = c.discount;
            document.getElementById("custCommissions").textContent = money(c.commissions);
            document.getElementById("custAction").textContent =
                c.commissions > 0 ? "Pagar comisiones pendientes." : "Invitar a subir de nivel.";

            document.getElementById("custDetailHint").textContent = "Estructura simulada.";
        }

        /******************************
         * Products
         ******************************/
        function renderProductAssetsUploaders() {
            const grid = document.getElementById("assetsGrid");
            if (!grid) return;

            grid.innerHTML = [
                assetUploader("Miniatura (carrito)", "square 1:1", "thumb"),
                assetUploader("CTA / Banner", "landscape 16:9", "cta"),
                assetUploader("Redes · Story", "9:16", "story"),
                assetUploader("Redes · Feed", "1:1", "feed"),
                assetUploader("Producto del Mes", "landscape 16:9", "pom"),
                assetUploader("Imagen extra", "opcional", "extra"),
            ].join("");
        }

        function renderProducts() {
            const tbody = document.getElementById("productsTable");

            tbody.innerHTML = DB.products.map(p => `
    <tr>
      <td class="px-4 py-3">${p.name}</td>
      <td class="px-4 py-3">${money(p.price)}</td>
      <td class="px-4 py-3">${p.active ? "Activo" : "Inactivo"}</td>
      <td class="px-4 py-3">
        <button class="px-3 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-xs"
                onclick="toast('Editar ${p.name}')">
          Editar
        </button>
      </td>
    </tr>
  `).join("");

            document.getElementById("productsCount").textContent = `${DB.products.length} productos`;
            document.getElementById("kpiProducts").textContent = DB.products.length;
            document.getElementById("kpiMissingAssets").textContent = "2";
            document.getElementById("kpiPOM").textContent = "COLÁGENO";
        }

        /******************************
         * Stats & warnings
         ******************************/
        function renderStats() {
            document.getElementById("kpiSalesToday").textContent = "$1,240";
            document.getElementById("kpiConv").textContent = "3.2%";
            document.getElementById("kpiAov").textContent = "$78";
            document.getElementById("kpiRepeat").textContent = "42%";

            const list = document.getElementById("warningsList");
            list.innerHTML = DB.warnings.map(w => `
    <div class="rounded-2xl bg-black/20 border border-white/10 p-4">
      <div class="text-sm font-semibold">${w.text}</div>
      <div class="text-xs text-zinc-500 mt-1">Severidad: ${w.severity}</div>
    </div>
  `).join("");

            document.getElementById("commDue").textContent = "$440";
            document.getElementById("shipDue").textContent = "2";
            document.getElementById("assetsMissing").textContent = "1";
            document.getElementById("urgentCount").textContent = "3";
        }

        /******************************
         * Assets preview
         ******************************/
        function previewAsset(e, key) {
            const file = e.target.files[0];
            if (!file) return;

            const img = document.getElementById(`asset-${key}`);
            const ph = document.getElementById(`asset-ph-${key}`);

            img.src = URL.createObjectURL(file);
            img.classList.remove("hidden");
            ph.classList.add("hidden");
        }

        /******************************
         * Sheets
         ******************************/
        function toggleSearchSheet() {
            document.getElementById("searchBackdrop").classList.toggle("hidden");
        }
        function toggleQuickActions() {
            document.getElementById("qaBackdrop").classList.toggle("hidden");
        }

        /******************************
         * Render all
         ******************************/
        function render() {
            if (currentView === "orders") renderOrders();
            if (currentView === "customers") renderCustomers();
            if (currentView === "products") {
                renderProducts();
                renderProductAssetsUploaders();
            }
            if (currentView === "stats") renderStats();
        }

        /* =========================
  3) JS: Overlay del Centro de Control
  - Reemplaza tu toggleQuickActions() (o reutiliza el botón "Acciones")
  - Para desktop seguimos mostrando el panel fijo si quieres, pero tú pediste
    dar espacio al center content: aquí lo hacemos overlay (mobile y desktop).
========================= */

        function toggleControlCenter(force) {
            console.log("toggle")
            const el = document.getElementById("controlCenterOverlay");
            console.log(el)
            if (!el) return;
            console.log("toggle2")
            const shouldOpen = (typeof force === "boolean") ? force : el.classList.contains("hidden");
            console.log(shouldOpen)
            if (shouldOpen) {
                el.classList.remove("hidden");
            } else {
                el.classList.add("hidden");
            }
        }

        /* Conecta el botón "Acciones" del header:
           Cambia onclick="toggleQuickActions()" por:
           onclick="toggleControlCenter()"
        */

        /******************************
 * ESTRUCTURA: datos + render del SVG con botones L1/L2
 * - Agrega esto dentro de tu JS (idealmente después de DB y antes de render)
 ******************************/

        /** Estructura por cliente (mock) */
        DB.customerStructures = {
            1: { // Ana
                root: {
                    id: "root", label: "Yo", level: 0, children: [
                        {
                            id: "l1a", label: "L1", level: 1, children: [
                                { id: "l2a", label: "L2", level: 2, children: [] },
                                { id: "l2b", label: "L2", level: 2, children: [] },
                            ]
                        },
                        {
                            id: "l1b", label: "L1", level: 1, children: [
                                { id: "l2c", label: "L2", level: 2, children: [] },
                            ]
                        },
                        { id: "l1c", label: "L1", level: 1, children: [] }
                    ]
                }
            },
            2: { // Carlos
                root: {
                    id: "root", label: "Yo", level: 0, children: [
                        { id: "l1a", label: "L1", level: 1, children: [] },
                        { id: "l1b", label: "L1", level: 1, children: [] },
                    ]
                }
            },
            3: { // Maria
                root: { id: "root", label: "Yo", level: 0, children: [] }
            }
        };

        let selectedCustomerId = null;
        let structureTargetNodeId = null;

        /** Override selectCustomer para guardar id y actualizar grafo */
        const __selectCustomerOriginal = selectCustomer;
        selectCustomer = function (id) {
            selectedCustomerId = id;
            __selectCustomerOriginal(id);
            renderCustomerGraph();
        };

        /** Render SVG con "botón +" en nodos L1 y L2 */
        function renderCustomerGraph() {
            const svg = document.getElementById("custGraph");
            if (!svg || !selectedCustomerId) return;

            // Simplificamos: colocación fija por niveles (0,1,2) con columnas.
            const structure = DB.customerStructures[selectedCustomerId]?.root;
            if (!structure) return;

            // Flatten nodes by depth (max 2)
            const L0 = [structure];
            const L1 = structure.children || [];
            const L2 = (L1.flatMap(n => n.children || []));

            // Helpers: position
            const pos = {};
            pos[structure.id] = { x: 120, y: 110 };

            // L1 positions
            const l1Ys = [70, 110, 150];
            L1.forEach((n, i) => pos[n.id] = { x: 260, y: l1Ys[i] ?? (70 + i * 40) });

            // L2 positions (spread)
            const l2Ys = [60, 90, 110, 140, 170];
            L2.forEach((n, i) => pos[n.id] = { x: 420, y: l2Ys[i] ?? (50 + i * 25) });

            // Build lines
            const lines = [];
            L1.forEach(n => lines.push([structure.id, n.id]));
            L1.forEach(n => (n.children || []).forEach(c => lines.push([n.id, c.id])));

            // SVG content
            const lineEls = lines.map(([a, b]) => {
                const A = pos[a], B = pos[b];
                return `<line x1="${A.x}" y1="${A.y}" x2="${B.x}" y2="${B.y}"></line>`;
            }).join("");

            // Nodes
            function nodeCircle(node) {
                const p = pos[node.id];
                if (!p) return "";
                const isRoot = node.level === 0;
                const r = isRoot ? 26 : (node.level === 1 ? 16 : 12);
                const fill = isRoot ? "rgba(59,130,246,.92)" : (node.level === 1 ? "rgba(245,185,66,.92)" : "rgba(139,92,246,.92)");
                const fontSize = isRoot ? 12 : (node.level === 1 ? 10 : 9);
                const label = node.label;

                // Add button for L1 and L2
                const showAdd = (node.level === 1 || node.level === 2);
                const btn = showAdd ? `
      <g class="cursor-pointer" onclick="openAddToStructureModal('${node.id}', ${node.level})">
        <circle cx="${p.x + r + 14}" cy="${p.y - r + 4}" r="10" fill="rgba(255,255,255,.10)" stroke="rgba(255,255,255,.18)" stroke-width="1.5"/>
        <text x="${p.x + r + 14}" y="${p.y - r + 8}" text-anchor="middle" font-size="14" fill="#ffffff" font-weight="900">+</text>
      </g>
    ` : "";

                return `
      <g>
        <circle cx="${p.x}" cy="${p.y}" r="${r}" fill="${fill}"></circle>
        <text x="${p.x}" y="${p.y + 4}" text-anchor="middle" font-size="${fontSize}" fill="#0b0f14" font-weight="900">${label}</text>
        ${btn}
      </g>
    `;
            }

            const nodeEls = [
                nodeCircle(structure),
                ...L1.map(nodeCircle),
                ...L2.map(nodeCircle),
            ].join("");

            svg.innerHTML = `
    <g stroke="rgba(255,255,255,.18)" stroke-width="2">${lineEls}</g>
    ${nodeEls}
  `;
        }

        /******************************
         * MODAL: open/close helpers
         ******************************/
        function openModal(id) {
            document.getElementById("modalBackdrop").classList.remove("hidden");
            document.getElementById(id).classList.remove("hidden");
        }
        function closeModal() {
            document.getElementById("modalBackdrop").classList.add("hidden");
            document.getElementById("modalNewOrder").classList.add("hidden");
            document.getElementById("modalAddToStructure").classList.add("hidden");
            structureTargetNodeId = null;
        }
        function resetModalFields() {
            ["orderCustomerName", "orderCustomerEmail", "orderTotal", "orderNote",
                "structName", "structEmail", "structPhone", "structNote"
            ].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = "";
            });
        }

        /******************************
         * MODAL: Nuevo Pedido
         * - Conectar al botón "Nuevo" del header
         ******************************/
        function openNewOrderModal() {
            resetModalFields();
            document.getElementById("orderStatus").value = "pending";
            openModal("modalNewOrder");
        }

        /** Cambia tu botón "Nuevo" del header para que llame esto:
            onclick="openNewOrderModal()"
        **/
        function createOrder() {
            const name = (document.getElementById("orderCustomerName").value || "").trim();
            const total = Number(document.getElementById("orderTotal").value || 0);
            const status = document.getElementById("orderStatus").value;

            if (!name || total <= 0) {
                toast("Completa cliente y total válido.");
                return;
            }

            const newIdNum = 1000 + DB.orders.length + 1;
            const order = {
                id: `#${newIdNum}`,
                customer: name,
                total,
                status
            };

            DB.orders.unshift(order);
            toast(`Pedido ${order.id} creado.`);
            closeModal();

            setView("orders");
            setOrderStatusTab(status);
        }

        /******************************
         * MODAL: Agregar cliente a estructura (L1/L2)
         ******************************/
        function openAddToStructureModal(nodeId, nodeLevel) {
            if (!selectedCustomerId) {
                toast("Selecciona un cliente primero.");
                return;
            }

            structureTargetNodeId = nodeId;
            document.getElementById("structureTargetLabel").textContent =
                (nodeLevel === 1 ? "Nivel 1" : "Nivel 2");

            resetModalFields();
            openModal("modalAddToStructure");
        }

        function addClientToStructure() {
            if (!selectedCustomerId || !structureTargetNodeId) {
                toast("No hay destino seleccionado.");
                return;
            }

            const name = (document.getElementById("structName").value || "").trim();
            const email = (document.getElementById("structEmail").value || "").trim();
            const levelStr = document.getElementById("structLevel").value || "Bronce|5%";
            const [levelName, discount] = levelStr.split("|");

            if (!name || !email) {
                toast("Nombre y email son obligatorios.");
                return;
            }

            // Create node
            const newNodeId = "n" + Math.random().toString(16).slice(2, 10);
            const newNode = {
                id: newNodeId,
                label: "L" + (findNodeLevel(DB.customerStructures[selectedCustomerId].root, structureTargetNodeId) + 1),
                level: findNodeLevel(DB.customerStructures[selectedCustomerId].root, structureTargetNodeId) + 1,
                children: []
            };

            // Insert node under target
            const root = DB.customerStructures[selectedCustomerId].root;
            const target = findNode(root, structureTargetNodeId);
            if (!target) {
                toast("Destino no encontrado.");
                return;
            }
            target.children = target.children || [];
            target.children.push(newNode);

            // Also create actual customer record (optional mock linkage)
            DB.customers.push({
                id: DB.customers.length + 1,
                name,
                email,
                level: levelName,
                discount,
                commissions: 0
            });

            toast("Cliente agregado a la estructura.");
            closeModal();
            renderCustomers();       // refresh list
            renderCustomerGraph();   // refresh graph
        }

        /******************************
         * Tree helpers
         ******************************/
        function findNode(node, id) {
            if (!node) return null;
            if (node.id === id) return node;
            for (const c of (node.children || [])) {
                const f = findNode(c, id);
                if (f) return f;
            }
            return null;
        }

        function findNodeLevel(node, id) {
            const n = findNode(node, id);
            return n ? (n.level || 0) : 0;
        }

        /******************************
         * Hook: botón Nuevo
         ******************************/
        // Si ya tienes un botón "Nuevo" en header:
        // reemplaza su onclick por openNewOrderModal()

        /* Ejemplo:
        <button ... onclick="openNewOrderModal()">Nuevo</button>
        */



        /******************************
         * Init
         ******************************/
        setView("orders");
    </script>
</body>

</html>