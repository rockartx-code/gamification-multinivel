<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>findingU ¬∑ Panel de Usuario</title>

  <!-- Tailwind CDN (referencia/maquetaci√≥n) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --bg-primary:#0b0f14;
      --bg-secondary:#121826;
    }

    body { background: var(--bg-primary); color:#fff; }

    /* Ambient background */
    .bg-ambient {
      background:
        radial-gradient(circle at 20% 20%, rgba(59,130,246,.18), transparent 45%),
        radial-gradient(circle at 80% 30%, rgba(245,185,66,.15), transparent 45%),
        radial-gradient(circle at 50% 85%, rgba(139,92,246,.12), transparent 55%),
        linear-gradient(to bottom, var(--bg-primary), var(--bg-secondary));
    }

    /* Grain */
    .grain:before{
      content:"";
      position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.22;
      pointer-events:none;
      border-radius:inherit;
    }

    /* Progress bar: base fill + in-cart overlay */
    .progress-rail{ background: rgba(255,255,255,.08); }
    .progress-base{ background: linear-gradient(90deg, rgba(59,130,246,.95), rgba(99,102,241,.95)); }
    .progress-cart{ background: linear-gradient(90deg, rgba(245,185,66,.95), rgba(249,115,22,.95)); }

    .glow-blue { box-shadow: 0 0 40px rgba(59,130,246,.45); }
    .glow-gold { box-shadow: 0 0 40px rgba(245,185,66,.45); }

    /* Fine: image mask can remain for hero assets if you use them later */
    .hero-image{
      mask-repeat:no-repeat;
      -webkit-mask-repeat:no-repeat;
    }

    /* Collapsible goals behavior */
    .goal-card { transition: all .25s ease; }
    .goals-collapsed .goal-expanded { display:none; }
    .goals-collapsed .goal-collapsed { display:block; }

    :focus-visible{
      outline:2px solid rgba(59,130,246,.85);
      outline-offset:3px;
    }
  </style>
</head>

<body class="antialiased">

  <!-- HEADER / STATUS (NO STICKY) -->
  <header class="z-50 border-b border-white/5 bg-[#0b0f14]/85 backdrop-blur">
    <div class="mx-auto max-w-6xl px-6 py-4">
      <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">

        <!-- Brand + User -->
        <div class="flex items-center justify-between gap-4">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-500 shadow-[0_0_30px_rgba(59,130,246,.45)]"></div>
            <div>
              <div class="font-extrabold tracking-tight">findingU</div>
              <div class="text-xs text-zinc-400 -mt-0.5">Panel de usuario</div>
            </div>
          </div>

          <div class="lg:hidden flex items-center gap-2">
            <a href="#merchant" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">Tienda</a>
            <a href="#red" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">Red</a>
          </div>
        </div>

        <!-- Countdown + Quick nav -->
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
          <div class="rounded-2xl bg-white/5 border border-white/10 px-4 py-3">
            <div class="text-xs text-zinc-400">Corte de mes en</div>
            <div class="text-lg font-extrabold tracking-tight" id="countdown">--d --h --m --s</div>
            <div class="text-xs text-zinc-500 mt-0.5">Cierra tu progreso antes del corte</div>
          </div>

          <nav class="hidden lg:flex items-center gap-2">
            <a href="#merchant" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">Tienda</a>
            <a href="#red" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">Red</a>
            <a href="#links" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">Links</a>
          </nav>

          <a href="#merchant" class="px-5 py-3 rounded-full font-semibold bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue hover:scale-[1.03] transition-transform text-sm">
            Obtenerlo ahora
          </a>
        </div>
      </div>

      <!-- Toggle metas -->
      <div class="mt-4 flex items-center justify-between">
        <div class="text-sm text-zinc-400">Progreso mensual</div>

        <button id="toggleGoalsBtn"
                class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">
          Colapsar metas
        </button>
      </div>

      <!-- Goals / Progress Strip -->
      <div class="mt-3 grid gap-3 lg:grid-cols-4" id="goalsStrip">
        <div class="relative rounded-2xl bg-white/5 border border-white/10 p-4 overflow-hidden grain" id="goal-active"></div>
        <div class="relative rounded-2xl bg-white/5 border border-white/10 p-4 overflow-hidden grain" id="goal-discount"></div>
        <div class="relative rounded-2xl bg-white/5 border border-white/10 p-4 overflow-hidden grain" id="goal-invite"></div>
        <div class="relative rounded-2xl bg-white/5 border border-white/10 p-4 overflow-hidden grain" id="goal-network"></div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="mx-auto max-w-6xl px-6 py-10 space-y-16">

    <!-- MERCHANT / PRODUCTS -->
    <section id="merchant" class="scroll-mt-10">
      <div class="flex items-end justify-between gap-6">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">Tienda</h2>
          <p class="mt-2 text-zinc-400 max-w-2xl">
            Completa tus metas de consumo. Al agregar al carrito, la barra se llena en un segundo color para indicar ‚Äúest√°s por cumplir‚Äù.
          </p>
        </div>

        <div class="hidden md:flex items-center gap-3">
          <div class="rounded-2xl bg-white/5 border border-white/10 px-4 py-3">
            <div class="text-xs text-zinc-400">Carrito</div>
            <div class="text-lg font-extrabold" id="cartTotal">$0</div>
          </div>
          <button class="px-5 py-3 rounded-full font-semibold bg-gradient-to-r from-yellow-400 to-orange-500 text-black glow-gold hover:scale-[1.03] transition-transform"
                  onclick="openCartToast()">
            Ver carrito
          </button>
        </div>
      </div>

      <!-- Product of the Month (large) -->
      <div class="mt-8 relative rounded-3xl border border-white/10 bg-ambient overflow-hidden grain">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_75%_35%,rgba(245,185,66,0.18),transparent_55%)]"></div>

        <div class="relative p-6 md:p-10 grid gap-8 md:grid-cols-2 items-center">
          <div>
            <span class="inline-flex items-center gap-2 rounded-full bg-yellow-400/15 border border-yellow-400/20 px-4 py-2 text-xs text-yellow-200 font-semibold">
              Producto del mes ¬∑ Recomendado para metas
            </span>
            <h3 class="mt-5 text-3xl md:text-4xl font-extrabold tracking-tight">
              COL√ÅGENO HIDROLIZADO
            </h3>
            <p class="mt-3 text-zinc-300 max-w-xl">
              Regeneraci√≥n + soporte esencial. Ideal para avanzar r√°pido a ‚ÄúUsuario Activo‚Äù y desbloquear descuentos.
            </p>

            <div class="mt-6 flex flex-wrap gap-2">
              <span class="px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-zinc-200">10g por porci√≥n</span>
              <span class="px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-zinc-200">Vitamina C + AH</span>
              <span class="px-4 py-2 rounded-full bg-white/5 border border-white/10 text-sm text-zinc-200">Alta absorci√≥n</span>
            </div>

            <div class="mt-8 flex flex-col sm:flex-row sm:items-center gap-3">
              <div class="flex items-center gap-3 rounded-2xl bg-[#121826] border border-white/10 p-3">
                <span class="text-sm text-zinc-400">Cantidad</span>
                <input id="qty-colageno" type="number" min="0" value="0"
                       class="w-20 rounded-xl bg-black/20 border border-white/10 px-3 py-2 text-white text-sm"
                       oninput="updateCart('colageno', this.value)">
                <span class="text-sm text-zinc-400">x $35</span>
              </div>

              <button class="px-6 py-3 rounded-full font-semibold bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue hover:scale-[1.03] transition-transform"
                      onclick="addQuick('colageno', 1)">
                Agregar al carrito
              </button>

              <button class="px-6 py-3 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 transition"
                      onclick="scrollToAndPulse('goal-active')">
                Ver meta relacionada
              </button>
            </div>
          </div>

          <!-- Visual slot (replace with real landscape image) -->
          <div class="relative h-[260px] md:h-[360px] rounded-3xl border border-white/10 overflow-hidden">
            <img src="imagenes/L-Colageno.png" alt="Producto del mes"
                 class="absolute inset-0 w-full h-full object-cover hero-image" />
            <div class="absolute inset-0 bg-gradient-to-tr from-[#0b0f14]/70 via-transparent to-transparent"></div>
            <div class="absolute -right-16 -top-16 h-64 w-64 rounded-full bg-yellow-400/10 blur-3xl"></div>

            <div class="relative h-full p-6 flex flex-col justify-end">
              <div class="text-sm text-zinc-200 font-semibold">Oferta estrat√©gica</div>
              <div class="text-xs text-zinc-400 mt-1">Optimiza tu corte de mes</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Buy Again -->
      <div class="mt-10">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">Volver a comprar</h3>
          <p class="text-sm text-zinc-400">Tus b√°sicos para mantener metas constantes.</p>
        </div>
        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3" id="buyAgain"></div>
      </div>

      <!-- All Products -->
      <div class="mt-12">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">Todos los productos</h3>
          <div class="text-sm text-zinc-400" id="productsCount">‚Äî</div>
        </div>
        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3" id="productsGrid"></div>
      </div>
    </section>

    <!-- NETWORK / GRAPH -->
    <section id="red" class="scroll-mt-10">
      <div class="flex items-end justify-between gap-6">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">Red</h2>
          <p class="mt-2 text-zinc-400 max-w-2xl">
            Visualiza niveles de referidos y el consumo mensual. Tu progreso tambi√©n puede depender de que tu red alcance sus metas.
          </p>
        </div>
        <a href="#links" class="px-5 py-3 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 transition">
          Compartir enlaces
        </a>
      </div>

      <div class="mt-8 grid gap-6 lg:grid-cols-2">
        <!-- Graph -->
        <div class="relative rounded-3xl border border-white/10 bg-white/5 p-6 grain overflow-hidden">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_40%_20%,rgba(59,130,246,0.12),transparent_55%)] pointer-events-none"></div>
          <div class="relative flex items-center justify-between">
            <div>
              <h3 class="text-xl font-bold">Grafo de niveles</h3>
              <p class="text-sm text-zinc-400 mt-1">Referencia visual (SVG). En producci√≥n, puedes mapearlo a datos reales.</p>
            </div>
            <button class="px-4 py-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue text-sm font-semibold hover:scale-[1.03] transition-transform"
                    onclick="simulateInvite()">
              Simular invitaci√≥n
            </button>
          </div>

          <div class="mt-6 rounded-2xl bg-[#121826] border border-white/10 p-4 overflow-hidden">
            <svg id="networkSvg" viewBox="0 0 560 260" class="w-full h-[260px]">
              <g stroke="rgba(255,255,255,.18)" stroke-width="2">
                <line x1="120" y1="130" x2="260" y2="70"></line>
                <line x1="120" y1="130" x2="260" y2="130"></line>
                <line x1="120" y1="130" x2="260" y2="190"></line>

                <line x1="260" y1="70" x2="420" y2="50"></line>
                <line x1="260" y1="70" x2="420" y2="90"></line>

                <line x1="260" y1="130" x2="420" y2="120"></line>
                <line x1="260" y1="130" x2="420" y2="160"></line>

                <line x1="260" y1="190" x2="420" y2="170"></line>
                <line x1="260" y1="190" x2="420" y2="210"></line>
              </g>

              <g>
                <circle cx="120" cy="130" r="28" fill="rgba(59,130,246,.92)"></circle>
                <text x="120" y="135" text-anchor="middle" font-size="12" fill="#0b0f14" font-weight="700">T√∫</text>

                <circle cx="260" cy="70" r="18" fill="rgba(245,185,66,.92)"></circle>
                <text x="260" y="75" text-anchor="middle" font-size="11" fill="#0b0f14" font-weight="700">L1</text>

                <circle cx="260" cy="130" r="18" fill="rgba(245,185,66,.92)"></circle>
                <text x="260" y="135" text-anchor="middle" font-size="11" fill="#0b0f14" font-weight="700">L1</text>

                <circle cx="260" cy="190" r="18" fill="rgba(245,185,66,.92)"></circle>
                <text x="260" y="195" text-anchor="middle" font-size="11" fill="#0b0f14" font-weight="700">L1</text>

                <circle cx="420" cy="50" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="54" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>

                <circle cx="420" cy="90" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="94" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>

                <circle cx="420" cy="120" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="124" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>

                <circle cx="420" cy="160" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="164" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>

                <circle cx="420" cy="170" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="174" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>

                <circle cx="420" cy="210" r="14" fill="rgba(139,92,246,.92)"></circle>
                <text x="420" y="214" text-anchor="middle" font-size="10" fill="#0b0f14" font-weight="800">L2</text>
              </g>
            </svg>
          </div>

          <div class="mt-4 grid grid-cols-3 gap-3 text-sm">
            <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
              <div class="text-xs text-zinc-400">Nivel 1</div>
              <div class="text-2xl font-extrabold mt-1" id="lvl1Count">3</div>
            </div>
            <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
              <div class="text-xs text-zinc-400">Nivel 2</div>
              <div class="text-2xl font-extrabold mt-1" id="lvl2Count">6</div>
            </div>
            <div class="rounded-2xl bg-white/5 border border-white/10 p-4">
              <div class="text-xs text-zinc-400">Activos</div>
              <div class="text-2xl font-extrabold mt-1" id="activeCount">2</div>
            </div>
          </div>
        </div>

        <!-- Network list / monthly consumption -->
        <div class="relative rounded-3xl border border-white/10 bg-white/5 p-6 grain overflow-hidden">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_20%,rgba(245,185,66,0.12),transparent_55%)] pointer-events-none"></div>
          <div class="relative">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-xl font-bold">Consumo mensual de tu red</h3>
                <p class="text-sm text-zinc-400 mt-1">Referencia para listados y estados de meta.</p>
              </div>
              <a href="#merchant" class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm">
                Impulsar consumo
              </a>
            </div>

            <div class="mt-6 overflow-hidden rounded-2xl border border-white/10">
              <table class="w-full text-sm">
                <thead class="bg-white/5 text-zinc-300">
                  <tr>
                    <th class="text-left px-4 py-3 font-semibold">Usuario</th>
                    <th class="text-left px-4 py-3 font-semibold">Nivel</th>
                    <th class="text-left px-4 py-3 font-semibold">Consumo mes</th>
                    <th class="text-left px-4 py-3 font-semibold">Estado</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-white/5 text-zinc-200" id="networkTable"></tbody>
              </table>
            </div>

            <div class="mt-6 rounded-2xl bg-[#121826] border border-white/10 p-5">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-xs text-zinc-400">Meta de red (este mes)</div>
                  <div class="text-lg font-extrabold mt-1"><span id="networkProgress">$0</span> / <span id="networkGoal">$0</span></div>
                </div>
                <a href="#links" class="px-5 py-3 rounded-full font-semibold bg-gradient-to-r from-yellow-400 to-orange-500 text-black glow-gold hover:scale-[1.03] transition-transform text-sm">
                  Compartir ahora
                </a>
              </div>

              <div class="mt-4 h-3 rounded-full progress-rail relative overflow-hidden">
                <div class="absolute inset-y-0 left-0 progress-base" id="networkBarBase" style="width:0%"></div>
              </div>
              <div class="mt-2 text-xs text-zinc-500">
                Sube la probabilidad de completar tu reto de ‚ÄúRed logra sus metas‚Äù antes del corte.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- REFERRAL LINKS -->
    <section id="links" class="scroll-mt-10">
      <div class="flex items-end justify-between gap-6">
        <div>
          <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">Links de referencia</h2>
          <p class="mt-2 text-zinc-400 max-w-2xl">
            Elige un producto destacado como gancho. Genera un link listo para pegar y una previsualizaci√≥n optimizada por red social.
          </p>
        </div>
        <a href="#merchant" class="px-5 py-3 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition">
          Ver productos
        </a>
      </div>

      <div class="mt-8 grid gap-6 lg:grid-cols-2">
        <!-- Selector -->
        <div class="relative rounded-3xl border border-white/10 bg-white/5 p-6 grain overflow-hidden">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_35%_20%,rgba(59,130,246,0.12),transparent_55%)] pointer-events-none"></div>

          <div class="relative">
            <h3 class="text-xl font-bold">Selecciona tu gancho</h3>
            <p class="text-sm text-zinc-400 mt-1">Esto cambia el link y los assets sociales.</p>

            <div class="mt-5 grid gap-3 sm:grid-cols-2" id="featuredSelector"></div>

            <div class="mt-6 rounded-2xl bg-[#121826] border border-white/10 p-4">
              <div class="text-xs text-zinc-400">Tu link</div>
              <div class="mt-2 flex flex-col sm:flex-row gap-3">
                <input id="refLink" readonly
                       class="flex-1 rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-zinc-200"
                       value="https://tu-dominio.com/r/ABC123?p=colageno">
                <button class="px-5 py-3 rounded-full font-semibold bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue hover:scale-[1.03] transition-transform"
                        onclick="copyRefLink()">
                  Copiar
                </button>
              </div>
              <div class="mt-2 text-xs text-zinc-500">
                Consejo: pega el link en historias/reels y fija un comentario con el mismo link en posts.
              </div>
            </div>
          </div>
        </div>

        <!-- Social preview -->
        <div class="relative rounded-3xl border border-white/10 bg-white/5 p-6 grain overflow-hidden">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_20%,rgba(245,185,66,0.12),transparent_55%)] pointer-events-none"></div>

          <div class="relative">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-xl font-bold">Previsualizaciones sociales</h3>
                <p class="text-sm text-zinc-400 mt-1">Mockups (reemplaza im√°genes por tus creatividades).</p>
              </div>

              <div class="flex gap-2">
                <button class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                        onclick="setSocialFormat('story')">
                  Story 9:16
                </button>
                <button class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                        onclick="setSocialFormat('feed')">
                  Feed 1:1
                </button>
                <button class="px-4 py-2 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-sm"
                        onclick="setSocialFormat('banner')">
                  Banner 16:9
                </button>
              </div>
            </div>

            <div class="mt-6 grid gap-4 md:grid-cols-2">
              <div class="rounded-2xl border border-white/10 bg-[#121826] overflow-hidden">
                <div class="px-4 py-3 bg-white/5 text-sm font-semibold text-zinc-200" id="socialTitle">Story (9:16)</div>
                <div class="p-4">
                  <div id="socialFrame" class="w-full rounded-2xl border border-white/10 overflow-hidden bg-ambient relative"
                       style="aspect-ratio: 9/16;">
                    <img id="socialImage" src="/images/social-colageno-story.jpg" alt="Social"
                         class="absolute inset-0 w-full h-full object-cover hero-image">
                    <div class="absolute inset-0 bg-gradient-to-tr from-[#0b0f14]/70 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-4">
                      <div class="text-xs text-zinc-200/90 font-semibold">OBTENERLO AHORA</div>
                      <div class="text-lg font-extrabold leading-tight" id="socialHook">COL√ÅGENO</div>
                      <div class="text-xs text-zinc-300 mt-1">Link en bio / swipe up</div>
                    </div>
                  </div>

                  <div class="mt-4 flex items-center justify-between gap-3">
                    <div class="text-xs text-zinc-500">
                      Imagen: <span class="text-zinc-300" id="socialAsset">/images/social-colageno-story.jpg</span>
                    </div>
                    <button class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 text-black glow-gold text-sm font-semibold hover:scale-[1.03] transition-transform"
                            onclick="copyAssetPath()">
                      Copiar ruta
                    </button>
                  </div>
                </div>
              </div>

              <div class="rounded-2xl border border-white/10 bg-[#121826] p-4">
                <div class="text-sm font-semibold text-zinc-200">Copy sugerido (editable)</div>
                <textarea id="captionBox" rows="10"
                          class="mt-3 w-full rounded-2xl bg-black/20 border border-white/10 px-4 py-3 text-sm text-zinc-200 placeholder:text-zinc-500"
                          placeholder="Escribe tu copy aqu√≠..."></textarea>
                <div class="mt-3 flex gap-3">
                  <button class="flex-1 px-5 py-3 rounded-full font-semibold bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue hover:scale-[1.03] transition-transform"
                          onclick="copyCaption()">
                    Copiar copy
                  </button>
                  <button class="flex-1 px-5 py-3 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 transition"
                          onclick="insertCaptionTemplate()">
                    Generar template
                  </button>
                </div>
                <div class="mt-2 text-xs text-zinc-500">
                  Recomendaci√≥n UX: 1 promesa + 1 prueba + 1 CTA. Evita promesas financieras.
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-50 hidden">
    <div class="rounded-full bg-[#121826] border border-white/10 px-5 py-3 text-sm text-zinc-200 shadow-[0_20px_60px_rgba(0,0,0,0.6)]">
      <span id="toastText">Actualizado.</span>
    </div>
  </div>

  <script>
     /***********************
     * Mock Data (replace)
     ***********************/
    const state = {
      user: {
        code: "ABC123",
        monthSpendActual: 45,       // already paid this month
        nextLevelSpendTarget: 120,  // to next discount tier
        activeSpendTarget: 60,      // minimum own consumption to be ‚Äúactive‚Äù
      },
      network: {
        goal: 300,
        members: [
          { name:"Mar√≠a G.", level:"L1", spend:80, status:"Activa" },
          { name:"Luis R.", level:"L1", spend:25, status:"En progreso" },
          { name:"Ana P.", level:"L1", spend:0,  status:"Inactiva" },
          { name:"Carlos V.", level:"L2", spend:40, status:"Activa" },
          { name:"Sof√≠a M.", level:"L2", spend:15, status:"En progreso" },
          { name:"Diego S.", level:"L2", spend:0,  status:"Inactiva" },
        ]
      },
      goals: {
        active:   { id:"active",   title:"Siguiente reto: Usuario activo",     subtitle:"Completa tu consumo m√≠nimo del mes",           target: 60,  base: 45, cart: 0, ctaText:"Ir a tienda",        ctaHref:"#merchant" },
        discount: { id:"discount", title:"Siguiente nivel de descuento",        subtitle:"Alcanza el umbral para mejorar tu beneficio", target: 120, base: 45, cart: 0, ctaText:"Completar consumo",  ctaHref:"#merchant" },
        invite:   { id:"invite",   title:"Crecer tu red",                       subtitle:"Agrega 1 usuario nuevo este mes",            target: 1,   base: 0,  cart: 0, ctaText:"Invitar ahora",     ctaHref:"#links" },
        network:  { id:"network",  title:"Red logra sus metas",                 subtitle:"Impulsa el consumo de tu red este mes",      target: 300, base: 160,cart: 0, ctaText:"Compartir enlace",  ctaHref:"#links" }
      },
      products: [
        { id:"colageno",     name:"COL√ÅGENO",     price:35, badge:"Regeneraci√≥n",  img:"imagenes/P-Colageno.png" },
        { id:"omega3",       name:"OMEGA-3",      price:29, badge:"Cuerpo & mente",img:"imagenes/L-Omega3.png" },
        { id:"creatina",     name:"CREATINA",     price:27, badge:"Fuerza",        img:"imagenes/L-Creatina.png" },
        { id:"complejoB",    name:"COMPLEJO B",   price:24, badge:"Energ√≠a",       img:"imagenes/L-ComplejoB.png" },
        { id:"antioxidante", name:"ANTIOXIDANTE", price:31, badge:"Longevidad",    img:"imagenes/L-Antioxidante.png" },
      ],
      buyAgainIds: ["omega3", "complejoB", "antioxidante"],
      cart: {} // { productId: qty }
    };

    const featured = [
      { id:"colageno",     label:"COL√ÅGENO",      hook:"Regenera. Fortalece. Perdura.", story:"imagenes/P-Colageno.png", feed:"imagenes/P-Colageno.png", banner:"imagenes/P-Colageno.png" },
      { id:"omega3",       label:"OMEGA-3",       hook:"Cuerpo y mente, todos los d√≠as.", story:"imagenes/P-Omega3.png", feed:"imagenes/L-Omega3.png", banner:"imagenes/L-Omega3.png" },
      { id:"creatina",     label:"CREATINA",      hook:"Potencia y rendimiento.", story:"imagenes/L-Creatina.png", feed:"imagenes/L-Creatina.png", banner:"imagenes/L-Creatina.png" },
      { id:"antioxidante", label:"ANTIOXIDANTE",  hook:"Brilla hoy. Longevidad ma√±ana.", story:"imagenes/L-Antioxidante.png", feed:"imagenes/L-Antioxidante.png", banner:"imagenes/L-Antioxidante.png" },
    ];

    let currentFeatured = featured[0];
    let currentFormat = "story";

    /***********************
     * Helpers
     ***********************/
    function money(n){ return "$" + Number(n || 0).toFixed(0); }
    function clampPct(x){ return Math.max(0, Math.min(100, x)); }

    function toast(msg){
      const el = document.getElementById("toast");
      const txt = document.getElementById("toastText");
      txt.textContent = msg;
      el.classList.remove("hidden");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> el.classList.add("hidden"), 2200);
    }

    function scrollToAndPulse(id){
      const node = document.getElementById(id);
      node?.scrollIntoView({ behavior:"smooth", block:"center" });
      node?.classList.add("ring-2","ring-yellow-400/60");
      setTimeout(()=> node?.classList.remove("ring-2","ring-yellow-400/60"), 1200);
    }

    function openCartToast(){ toast(`Carrito: ${money(getCartTotal())}`); }

    /***********************
     * Countdown
     ***********************/
    function endOfMonthDate(){
      const now = new Date();
      const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
      lastDay.setHours(23,59,59,999);
      return lastDay;
    }

    function startCountdown(){
      const target = endOfMonthDate().getTime();
      const el = document.getElementById("countdown");
      function tick(){
        let diff = Math.max(0, target - Date.now());
        const d = Math.floor(diff / (1000*60*60*24)); diff -= d*(1000*60*60*24);
        const h = Math.floor(diff / (1000*60*60)); diff -= h*(1000*60*60);
        const m = Math.floor(diff / (1000*60)); diff -= m*(1000*60);
        const s = Math.floor(diff / 1000);
        el.textContent = `${d}d ${h}h ${m}m ${s}s`;
      }
      tick();
      setInterval(tick, 1000);
    }

    /***********************
     * Goals UI
     ***********************/
    function goalCardHTML(goalKey){
      const g = state.goals[goalKey];
      const isCountGoal = (goalKey === "invite");

      const baseVal = g.base;
      const cartVal = isCountGoal ? 0 : g.cart;

      const basePct = clampPct((baseVal / g.target) * 100);
      const cartPct = clampPct(((baseVal + cartVal) / g.target) * 100);

      const progressLabel = isCountGoal
        ? `${baseVal} / ${g.target}`
        : `${money(baseVal)} / ${money(g.target)}`;

      return `
        <div class="goal-card" data-goal="${goalKey}">
          <div class="goal-expanded">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-xs text-zinc-400">${g.subtitle}</div>
                <div class="mt-1 font-extrabold tracking-tight">${g.title}</div>
              </div>
              <a href="${g.ctaHref}"
                 class="shrink-0 px-4 py-2 rounded-full text-sm font-semibold bg-white/5 border border-white/10 hover:bg-white/10 transition">
                ${g.ctaText}
              </a>
            </div>
          </div>

          <div class="goal-collapsed hidden">
            <div class="text-xs text-zinc-400">${g.subtitle}</div>
          </div>

          <div class="mt-3 flex items-center justify-between text-xs text-zinc-400">
            <span>${progressLabel}</span>
            ${cartVal > 0 ? `<span class="text-yellow-300">+${money(cartVal)} en carrito</span>` : ``}
          </div>

          <div class="mt-2 h-3 rounded-full progress-rail relative overflow-hidden">
            <div class="absolute inset-y-0 left-0 progress-base" style="width:${basePct}%"></div>
            <div class="absolute inset-y-0 left-0 progress-cart opacity-90" style="width:${cartPct}%"></div>
          </div>
        </div>
      `;
    }

    function renderGoals(){
      document.getElementById("goal-active").innerHTML   = goalCardHTML("active");
      document.getElementById("goal-discount").innerHTML = goalCardHTML("discount");
      document.getElementById("goal-invite").innerHTML   = goalCardHTML("invite");
      document.getElementById("goal-network").innerHTML  = goalCardHTML("network");
    }

    /***********************
     * Cart logic
     ***********************/
    function getCartTotal(){
      let total = 0;
      for (const [pid, qty] of Object.entries(state.cart)){
        const p = state.products.find(x => x.id === pid);
        total += (p?.price || 0) * Number(qty || 0);
      }
      return total;
    }

    function updateCart(productId, qty){
      const q = Math.max(0, Number(qty || 0));
      if (q === 0) delete state.cart[productId];
      else state.cart[productId] = q;

      const cartTotal = getCartTotal();
      state.goals.active.cart = cartTotal;
      state.goals.discount.cart = cartTotal;

      document.getElementById("cartTotal").textContent = money(cartTotal);
      renderGoals();

      if (cartTotal > 0) toast(`En carrito: ${money(cartTotal)} (pendiente de pago)`);
    }

    function addQuick(productId, addQty){
      const current = Number(state.cart[productId] || 0);
      const next = current + addQty;
      state.cart[productId] = next;
      const input = document.getElementById(`qty-${productId}`);
      if (input) input.value = next;
      updateCart(productId, next);
    }

    /***********************
     * Products UI (UPDATED: add image slot on small cards)
     ***********************/
    function productCard(p){
      const price = money(p.price);

      return `
        <article class="relative rounded-3xl border border-white/10 bg-[#121826] p-5 overflow-hidden hover:shadow-[0_0_70px_rgba(59,130,246,0.18)] transition-shadow">
          <div class="absolute inset-0 bg-[radial-gradient(circle_at_70%_30%,rgba(59,130,246,0.10),transparent_55%)] pointer-events-none"></div>

          <div class="relative flex gap-4">
            <!-- IMAGE SLOT -->
            <div class="w-20 h-20 shrink-0 rounded-2xl border border-white/10 bg-white/5 overflow-hidden flex items-center justify-center">
              <img src="${p.img}" alt="${p.name}"
                   class="w-full h-full object-cover"
                   onerror="this.style.display='none'; this.parentElement.classList.add('bg-gradient-to-br','from-blue-500/10','to-indigo-500/10');" />
            </div>

            <!-- CONTENT -->
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between gap-3">
                <div class="min-w-0">
                  <div class="text-xs text-zinc-400">Producto</div>
                  <h4 class="mt-1 font-extrabold tracking-tight truncate">${p.name}</h4>
                  <div class="mt-1 text-xs text-zinc-500 truncate">${p.badge}</div>
                </div>
                <div class="text-sm font-extrabold whitespace-nowrap">${price}</div>
              </div>

              <div class="mt-4 flex items-center gap-3">
                <div class="flex items-center gap-2 rounded-2xl bg-black/20 border border-white/10 px-3 py-2">
                  <span class="text-xs text-zinc-400">Qty</span>
                  <input id="qty-${p.id}" type="number" min="0" value="${Number(state.cart[p.id] || 0)}"
                         class="w-14 rounded-xl bg-transparent border border-white/10 px-2 py-1 text-sm text-white"
                         oninput="updateCart('${p.id}', this.value)">
                </div>

                <button class="flex-1 px-5 py-2.5 rounded-full font-semibold bg-gradient-to-r from-blue-500 to-indigo-500 glow-blue hover:scale-[1.02] transition-transform text-sm"
                        onclick="addQuick('${p.id}', 1)">
                  Agregar
                </button>
              </div>
            </div>
          </div>

          <div class="relative mt-3 flex items-center justify-between text-xs text-zinc-500">
            <button class="hover:text-zinc-200 transition" onclick="toast('Detalle de producto (hook)')">Ver detalle</button>
            <button class="hover:text-zinc-200 transition" onclick="toast('Comparar (hook)')">Comparar</button>
          </div>
        </article>
      `;
    }

    function renderProducts(){
      const buyAgainEl = document.getElementById("buyAgain");
      buyAgainEl.innerHTML = state.buyAgainIds
        .map(id => state.products.find(p => p.id === id))
        .filter(Boolean)
        .map(p => productCard(p))
        .join("");

      const gridEl = document.getElementById("productsGrid");
      gridEl.innerHTML = state.products
        .filter(p => !state.buyAgainIds.includes(p.id))
        .map(p => productCard(p))
        .join("");

      document.getElementById("productsCount").textContent = `${state.products.length} productos`;
    }

    /***********************
     * Network table + progress
     ***********************/
    function renderNetwork(){
      const tbody = document.getElementById("networkTable");
      tbody.innerHTML = state.network.members.map(m => {
        const badge =
          m.status === "Activa"
            ? `<span class="px-3 py-1 rounded-full bg-blue-500/15 border border-blue-400/20 text-blue-200 text-xs">Activa</span>`
            : (m.status === "En progreso"
              ? `<span class="px-3 py-1 rounded-full bg-yellow-400/15 border border-yellow-400/20 text-yellow-200 text-xs">En progreso</span>`
              : `<span class="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-zinc-300 text-xs">Inactiva</span>`);

        return `
          <tr>
            <td class="px-4 py-3">${m.name}</td>
            <td class="px-4 py-3 text-zinc-300">${m.level}</td>
            <td class="px-4 py-3">${money(m.spend)}</td>
            <td class="px-4 py-3">${badge}</td>
          </tr>
        `;
      }).join("");

      const lvl1 = state.network.members.filter(m => m.level === "L1").length;
      const lvl2 = state.network.members.filter(m => m.level === "L2").length;
      const actives = state.network.members.filter(m => m.status === "Activa").length;

      document.getElementById("lvl1Count").textContent = String(lvl1);
      document.getElementById("lvl2Count").textContent = String(lvl2);
      document.getElementById("activeCount").textContent = String(actives);

      const sum = state.network.members.reduce((acc,m)=>acc + (m.spend||0), 0);
      document.getElementById("networkProgress").textContent = money(sum);
      document.getElementById("networkGoal").textContent = money(state.network.goal);

      const pct = clampPct((sum / state.network.goal) * 100);
      document.getElementById("networkBarBase").style.width = pct + "%";
    }

    function simulateInvite(){
      state.goals.invite.base = Math.min(state.goals.invite.target, state.goals.invite.base + 1);
      renderGoals();
      toast("Invitaci√≥n registrada (simulaci√≥n).");
    }

    /***********************
     * Referral selector + social preview
     ***********************/
    function renderFeaturedSelector(){
      const el = document.getElementById("featuredSelector");
      el.innerHTML = featured.map(f => {
        const active = (f.id === currentFeatured.id);
        return `
          <button class="text-left rounded-2xl border ${active ? "border-blue-400/40 bg-blue-500/10" : "border-white/10 bg-white/5"}
                         hover:bg-white/10 transition p-4"
                  onclick="selectFeatured('${f.id}')">
            <div class="text-xs text-zinc-400">Gancho</div>
            <div class="mt-1 font-extrabold tracking-tight">${f.label}</div>
            <div class="mt-2 text-xs text-zinc-400">${f.hook}</div>
          </button>
        `;
      }).join("");
    }

    function selectFeatured(id){
      currentFeatured = featured.find(x => x.id === id) || featured[0];
      const link = `https://tu-dominio.com/r/${state.user.code}?p=${currentFeatured.id}`;
      document.getElementById("refLink").value = link;
      applySocialPreview();
      renderFeaturedSelector();
      toast(`Gancho seleccionado: ${currentFeatured.label}`);
    }

    function setSocialFormat(fmt){ currentFormat = fmt; applySocialPreview(); }

    function applySocialPreview(){
      const title = document.getElementById("socialTitle");
      const frame = document.getElementById("socialFrame");
      const img = document.getElementById("socialImage");
      const hook = document.getElementById("socialHook");
      const asset = document.getElementById("socialAsset");

      let aspect = "9/16";
      let label = "Story (9:16)";
      let src = currentFeatured.story;

      if (currentFormat === "feed"){ aspect = "1/1"; label = "Feed (1:1)"; src = currentFeatured.feed; }
      else if (currentFormat === "banner"){ aspect = "16/9"; label = "Banner (16:9)"; src = currentFeatured.banner; }

      title.textContent = label;
      frame.style.aspectRatio = aspect;
      img.src = src;
      hook.textContent = currentFeatured.label;
      asset.textContent = src;

      insertCaptionTemplate(true);
    }

    function copyRefLink(){
      const v = document.getElementById("refLink").value;
      navigator.clipboard?.writeText(v);
      toast("Link copiado.");
    }

    function copyAssetPath(){
      const v = document.getElementById("socialAsset").textContent;
      navigator.clipboard?.writeText(v);
      toast("Ruta de imagen copiada.");
    }

    function insertCaptionTemplate(silent=false){
      const link = document.getElementById("refLink").value;
      document.getElementById("captionBox").value =
`Estoy usando ${currentFeatured.label} para mejorar mi bienestar este mes.

‚úÖ ${currentFeatured.hook}
üéØ Meta del mes: cerrar como usuario activo y desbloquear recompensas.
üëâ Obtenerlo ahora: ${link}

#Bienestar #Energ√≠a #Rutina #findingU`;
      if (!silent) toast("Template de copy generado.");
    }

    function copyCaption(){
      const v = document.getElementById("captionBox").value;
      navigator.clipboard?.writeText(v);
      toast("Copy copiado.");
    }

    /***********************
     * Goals collapse toggle
     ***********************/
    let goalsCollapsed = false;
    function setGoalsCollapsed(collapsed){
      goalsCollapsed = !!collapsed;
      const header = document.querySelector("header");
      const btn = document.getElementById("toggleGoalsBtn");
      if (goalsCollapsed){
        header.classList.add("goals-collapsed");
        btn.textContent = "Expandir metas";
      } else {
        header.classList.remove("goals-collapsed");
        btn.textContent = "Colapsar metas";
      }
    }

    /***********************
     * Init
     ***********************/
    function init(){
      startCountdown();

      state.goals.active.base   = state.user.monthSpendActual;
      state.goals.active.target = state.user.activeSpendTarget;
      state.goals.discount.base   = state.user.monthSpendActual;
      state.goals.discount.target = state.user.nextLevelSpendTarget;

      document.getElementById("cartTotal").textContent = money(getCartTotal());

      renderGoals();
      renderProducts();
      renderNetwork();

      renderFeaturedSelector();
      selectFeatured(currentFeatured.id);

      document.getElementById("toggleGoalsBtn").addEventListener("click", () => {
        setGoalsCollapsed(!goalsCollapsed);
        toast(goalsCollapsed ? "Metas colapsadas." : "Metas expandidas.");
      });

      setGoalsCollapsed(false);
    }

    init();
  </script>
</body>
</html>
