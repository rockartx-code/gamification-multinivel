<article
  *ngIf="mode === 'detailed'; else compactCard"
  class="relative overflow-hidden rounded-3xl border border-olive-30 surface-soft p-4 sm:p-5 transition-shadow hover:shadow-[0_0_70px_rgba(59,130,246,0.18)]">
  <div class="pointer-events-none absolute inset-0 bg-olive-10"></div>

  <div class="relative flex gap-3 sm:gap-4">
    <div class="flex h-16 w-16 sm:h-20 sm:w-20 shrink-0 items-center justify-center overflow-hidden rounded-2xl border border-olive-30 bg-ivory-80">
      <img [src]="product.img" [alt]="product.name" class="h-full w-full object-cover" />
    </div>

    <div class="min-w-0 flex-1">
      <div class="flex items-start justify-between gap-3">
        <div class="min-w-0">
          <div class="text-xs text-gray-600">Producto</div>
          <h4 class="mt-1 font-extrabold tracking-tight leading-snug line-clamp-2 sm:truncate">{{ product.name }}</h4>
          <div class="mt-1 text-xs text-gray-500 line-clamp-1 sm:truncate">{{ product.badge }}</div>
        </div>

        <div class="text-right shrink-0">
          <div *ngIf="hasDiscount" class="text-[11px] text-gray-500 line-through">{{ originalPriceLabel }}</div>
          <div class="whitespace-nowrap text-sm font-extrabold">{{ discountedPriceLabel }}</div>
          <div class="text-[10px]" [ngClass]="hasDiscount ? 'text-accent' : 'text-gray-500'">{{ discountLabel }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="relative mt-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div class="flex items-center justify-between gap-2 rounded-2xl border border-olive-30 surface-soft px-3 py-2 sm:justify-start">
      <span class="text-xs text-gray-600">Qty</span>
      <ui-form-field
        type="number"
        [ngModel]="qty"
        (ngModelChange)="qtyChange.emit(+$event || 0)"
        inputClass="w-20 sm:w-14 rounded-xl border border-olive-30 bg-white/70 px-2 py-1 text-sm text-main"></ui-form-field>
    </div>

    <div class="flex w-full flex-col gap-2 sm:flex-1">
      <ui-button size="lg" variant="ghost" class="w-full" (pressed)="viewDetails.emit()">
        <i class="fa-solid fa-eye" aria-hidden="true"></i>
        Ver detalles
      </ui-button>

      <ui-button size="lg" variant="primary" class="w-full" (pressed)="add.emit()">
        <i class="fa-solid fa-plus" aria-hidden="true"></i>
        Agregar
      </ui-button>
    </div>
  </div>
</article>

<ng-template #compactCard>
  <article class="flex min-w-0 flex-col gap-2 rounded-2xl border border-olive-30 bg-ivory-80 p-3 overflow-hidden">
    <div class="flex min-w-0 items-center gap-3">
      <div class="flex h-12 w-12 shrink-0 items-center justify-center overflow-hidden rounded-2xl border border-olive-30 surface-soft">
        <img [src]="product.img" [alt]="product.name" class="h-full w-full object-cover" />
      </div>
      <div class="min-w-0 flex-1">
        <div class="truncate text-sm font-semibold text-main" [title]="product.name">{{ product.name }}</div>
        <div class="truncate text-[11px] text-gray-500">{{ product.badge }}</div>
      </div>
    </div>

    <div class="flex flex-wrap items-center justify-between gap-2">
      <div class="text-sm font-extrabold whitespace-nowrap">{{ discountedPriceLabel }}</div>
      <div class="flex flex-wrap items-center gap-2">
        <ui-button variant="ghost" size="sm" iconClass="fa-solid fa-circle-info" extraClass="whitespace-nowrap" (pressed)="viewDetails.emit()">Ver detalle</ui-button>
        <ui-button variant="ghost" size="sm" iconClass="fa-solid fa-plus" extraClass="whitespace-nowrap" (pressed)="add.emit()">Agregar</ui-button>
      </div>
    </div>
  </article>
</ng-template>


